<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>读取题目</title>
	<style>
	   *{margin: 0; padding: 0}
		body{
			padding: 10px;

		}
		input{height: 20px; border:1px solid #ccc;}
		.ipt{width: 90%}
		#btn{width: 9%; background-color: #0c0;}
	</style>
</head>
<body>

  
  <input type="text" class="ipt"> <input type="button" value="读取" id="btn">


 <script>
    var $ = require("jQuery");

   var client = require("./module/http_client.js");

   var save = require("./module/dir.js");
   

   // var url = "http://www.mofangge.com/app/highfren/hfinfo.aspx?sid=524&sub=02&zm=2&sna=%E4%B8%A4%E8%A7%92%E5%92%8C%E4%B8%8E%E5%B7%AE%E7%9A%84%E4%B8%89%E8%A7%92%E5%87%BD%E6%95%B0%E5%8F%8A%E4%B8%89%E8%A7%92%E6%81%92%E7%AD%89%E5%8F%98%E6%8D%A2&pn=1";
   var url = "http://www.mofangge.com/ajax/aHighFren.ashx?ije7t5mj&act=getQList&sub=02&type=3&sec=524&pn=";
   client.setCookie("bdshare_firstime","1452769963013");
   client.setHost("www.mofangge.com");
   client.setCookie("mfg_memberid","76828387");
   client.setCookie("mfg_membersgin","2D7D781092ECDE7FBC45BD078D26080A5D039BD380D0D2BF3387D8B5191D5A3B233AF9D732A91C9C71D4DBBCB65BD06E9C813CD0B459F8B00E9F346C7B27521F7AAF2852D5592E9681ED1DE53AE9E4F3");
   client.setMethod("GET");
   client.setType("text/plain; charset=utf-8");
  
   var html =[];
   var page = 1;
   function writeHtml(str){
   	    var  dom = str.substr(10);
   	    var tds = $(dom).find("h3");
   	    var com = $(dom).find(".question");
   	    console.log(page);
   	    
   	    for (var i = tds.length - 1; i >= 0; i--) {
   	    	var str = {};
   	    	str["title"] = tds.eq(i).text();
   	    	str["con"]= com.eq(i).html();
   	  	    html.push(str);
   	    };
   	    
   	   appcall.call(this,writeHtml);
   }
   appcall(writeHtml)
   
   function appcall (callback){
   	 page++;
   	 if (page>5) {
   	 	save.saveFile(html)
   	 	return;
   	 };
   	client.post(url+page,{},callback)
   }


</script>
</body>
</html>
